{"ast":null,"code":"import _regeneratorRuntime from\"/Users/wanghongguang/Desktop/homework/reactUpload/reactupload/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/wanghongguang/Desktop/homework/reactUpload/reactupload/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/wanghongguang/Desktop/homework/reactUpload/reactupload/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import moment from'moment';import{Card,Button,Table,Space,Modal,Form,Input,message}from'antd';import{noHomeWorkListName,changeFileFormat,detailList,deleteAll,deteleOne}from'../../../axios/api';var confirm=Modal.confirm;var Manager=function Manager(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),noHomeWorkList=_useState2[0],setNoHomeWorkList=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),dataSource=_useState4[0],setDataSource=_useState4[1];var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];useEffect(function(){getNoHomeWorkList();getDetailList();},[]);var onFinish=function onFinish(value){toChangeFileFormat(value);form.resetFields();};//获取全部文件\nvar getAllFile=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var token;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:token=window.localStorage.getItem('token');window.location.assign('http://localhost:3001/file/downloadall/'+token);case 2:case\"end\":return _context.stop();}}},_callee);}));return function getAllFile(){return _ref.apply(this,arguments);};}();var getOneFile=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(name){var token;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:token=window.localStorage.getItem('token');window.location.assign('http://localhost:3001/file/download/'+name+'/'+token);case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function getOneFile(_x){return _ref2.apply(this,arguments);};}();//修改文件名称的接口\nvar toChangeFileFormat=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(param){var _yield$changeFileForm,msg,status;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return changeFileFormat(param);case 3:_yield$changeFileForm=_context3.sent;msg=_yield$changeFileForm.msg;status=_yield$changeFileForm.status;if(status=='200'){message.success('修改成功');}else{message.error(msg);}_context3.next=13;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);message.error(\"访问修改接口失败\");case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[0,9]]);}));return function toChangeFileFormat(_x2){return _ref3.apply(this,arguments);};}();//获取未完成作业的列表\nvar getNoHomeWorkList=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _yield$noHomeWorkList,data,status,msg;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return noHomeWorkListName();case 3:_yield$noHomeWorkList=_context4.sent;data=_yield$noHomeWorkList.data;status=_yield$noHomeWorkList.status;msg=_yield$noHomeWorkList.msg;if(status=='200'){message.success('获取未完成作业列表成功');setNoHomeWorkList(data.data);}else{message.error(msg);}_context4.next=14;break;case 10:_context4.prev=10;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);message.error('获取未完成作业接口失败');case 14:case\"end\":return _context4.stop();}}},_callee4,null,[[0,10]]);}));return function getNoHomeWorkList(){return _ref4.apply(this,arguments);};}();//获取文件详情数据的接口\nvar getDetailList=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var _yield$detailList,data,status,msg;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return detailList();case 3:_yield$detailList=_context5.sent;data=_yield$detailList.data;status=_yield$detailList.status;msg=_yield$detailList.msg;if(status=='200'){message.success('获取列表成功');setDataSource(data.data);}else{message.error(msg);}_context5.next=12;break;case 10:_context5.prev=10;_context5.t0=_context5[\"catch\"](0);case 12:case\"end\":return _context5.stop();}}},_callee5,null,[[0,10]]);}));return function getDetailList(){return _ref5.apply(this,arguments);};}();var columns=[{title:'姓名',dataIndex:'name',key:'name'},{title:'学号',dataIndex:'sid',key:'sid',sorter:function sorter(a,b){return Number(a.sid)-Number(b.sid);}},{title:'文件名称',dataIndex:'fileName',key:'fileName'},{title:'提交时间',dataIndex:'ctime',key:'ctime',sorter:function sorter(a,b){return new Date(a.ctime).getTime()-new Date(b.ctime).getTime();},render:function render(text){return moment(text).format('YYYY-MM-DD HH:mm:ss');}},{title:'操作',dataIndex:'action',key:'action',render:function render(text,record){return/*#__PURE__*/React.createElement(Space,{size:\"middle\"},/*#__PURE__*/React.createElement(\"a\",{onClick:function onClick(){return toDeleteData(record);}},\"\\u5220\\u9664\"),/*#__PURE__*/React.createElement(\"a\",{onClick:function onClick(){getOneFile(record.fileName);}},\"\\u5BFC\\u51FA\"));}}];var layout={labelCol:{span:6},wrapperCol:{span:16}};var tailLayout={wrapperCol:{offset:10,span:14}};var toDeleteData=function toDeleteData(record){confirm({title:'确定删除这条数据?',okText:\"确认\",cancelText:\"取消\",onOk:function(){var _onOk=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var _yield$deteleOne,status,msg;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return deteleOne({name:record.fileName});case 3:_yield$deteleOne=_context6.sent;status=_yield$deteleOne.status;msg=_yield$deteleOne.msg;if(status=='200'){message.success('删除文档成功');getDetailList();getNoHomeWorkList();}else{message.error(msg);}_context6.next=13;break;case 9:_context6.prev=9;_context6.t0=_context6[\"catch\"](0);console.log(_context6.t0);message.error('删除单个接口失败');case 13:case\"end\":return _context6.stop();}}},_callee6,null,[[0,9]]);}));function onOk(){return _onOk.apply(this,arguments);}return onOk;}(),onCancel:function onCancel(){console.log('Cancel');}});};var toDeleteAll=function toDeleteAll(){confirm({title:'确定清空数据?',okText:\"确认\",cancelText:\"取消\",onOk:function(){var _onOk2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var _yield$deleteAll,status,msg;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.prev=0;_context7.next=3;return deleteAll();case 3:_yield$deleteAll=_context7.sent;status=_yield$deleteAll.status;msg=_yield$deleteAll.msg;if(status=='200'){message.success('删除全部文档成功');getDetailList();getNoHomeWorkList();}else{message.error(msg);}_context7.next=12;break;case 9:_context7.prev=9;_context7.t0=_context7[\"catch\"](0);message.error('删除全部接口失败');case 12:case\"end\":return _context7.stop();}}},_callee7,null,[[0,9]]);}));function onOk(){return _onOk2.apply(this,arguments);}return onOk;}(),onCancel:function onCancel(){console.log('Cancel');}});};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"h3\",null,\"\\u7BA1\\u7406\\u4F5C\\u4E1A\"),/*#__PURE__*/React.createElement(Card,{title:\"\\u4F5C\\u4E1A\\u672A\\u4E0A\\u4EA4\\u540D\\u5355\",style:{marginBottom:'50px'}},/*#__PURE__*/React.createElement(\"div\",{style:{display:'flex',flexWrap:'wrap'}},Array.isArray(noHomeWorkList)?noHomeWorkList.map(function(item,index){return/*#__PURE__*/React.createElement(\"div\",{key:index,style:{width:'50px',textAlign:'center',color:'red'}},item);}):null)),/*#__PURE__*/React.createElement(Card,{title:\"\\u4F5C\\u4E1A\\u5185\\u5BB9\",style:{marginBottom:'50px'}},/*#__PURE__*/React.createElement(\"div\",{style:{width:'600px',margin:'auto'}},/*#__PURE__*/React.createElement(Form,Object.assign({},layout,{name:\"basic\",onFinish:onFinish,form:form}),/*#__PURE__*/React.createElement(Form.Item,{label:\"\\u4E0A\\u4F20\\u4F5C\\u4E1A\\u5185\\u5BB9\",name:\"content\",rules:[{required:true,message:'请输入作业内容'}]},/*#__PURE__*/React.createElement(Input,null)),/*#__PURE__*/React.createElement(Form.Item,{label:\"\\u547D\\u540D\\u683C\\u5F0F\",name:\"format\",rules:[{required:true,message:'请输入命名格式'}]},/*#__PURE__*/React.createElement(Input,null)),/*#__PURE__*/React.createElement(Form.Item,tailLayout,/*#__PURE__*/React.createElement(Button,{type:\"primary\",htmlType:\"submit\"},\"\\u63D0\\u4EA4\"))))),/*#__PURE__*/React.createElement(Card,{title:\"\\u4F5C\\u4E1A\\u5217\\u8868\",extra:/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{type:\"primary\",style:{fontSize:\"14px\"},onClick:getAllFile},\"\\u5168\\u90E8\\u5BFC\\u51FA\"),/*#__PURE__*/React.createElement(Button,{type:\"primary\",style:{fontSize:\"14px\",marginLeft:'10px'},onClick:toDeleteAll},\"\\u6E05\\u7A7A\\u6570\\u636E\"))},/*#__PURE__*/React.createElement(Table,{dataSource:dataSource,columns:columns})));};export default Manager;","map":{"version":3,"sources":["/Users/wanghongguang/Desktop/homework/reactUpload/reactupload/src/page/upload/manager/index.jsx"],"names":["React","useEffect","useState","moment","Card","Button","Table","Space","Modal","Form","Input","message","noHomeWorkListName","changeFileFormat","detailList","deleteAll","deteleOne","confirm","Manager","noHomeWorkList","setNoHomeWorkList","dataSource","setDataSource","useForm","form","getNoHomeWorkList","getDetailList","onFinish","value","toChangeFileFormat","resetFields","getAllFile","token","window","localStorage","getItem","location","assign","getOneFile","name","param","msg","status","success","error","console","log","data","columns","title","dataIndex","key","sorter","a","b","Number","sid","Date","ctime","getTime","render","text","format","record","toDeleteData","fileName","layout","labelCol","span","wrapperCol","tailLayout","offset","okText","cancelText","onOk","onCancel","toDeleteAll","marginBottom","display","flexWrap","Array","isArray","map","item","index","width","textAlign","color","margin","required","fontSize","marginLeft"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport moment from 'moment'\nimport { Card, Button, Table, Space, Modal, Form, Input, message } from 'antd'\nimport { noHomeWorkListName, changeFileFormat, detailList, deleteAll, deteleOne } from '../../../axios/api'\nconst { confirm } = Modal;\n\n\n\nconst Manager = () => {\n    const [noHomeWorkList, setNoHomeWorkList] = useState([])\n    const [dataSource, setDataSource] = useState([])\n    const [form] = Form.useForm()\n\n\n    useEffect(() => {\n        getNoHomeWorkList()\n        getDetailList()\n    }, [])\n\n    const onFinish = (value) => {\n        toChangeFileFormat(value)\n        form.resetFields()\n\n    }\n\n    //获取全部文件\n    const getAllFile = async () => {\n        const token = window.localStorage.getItem('token')\n        window.location.assign('http://localhost:3001/file/downloadall/' + token)\n    }\n\n    const getOneFile = async (name) => {\n        const token = window.localStorage.getItem('token')\n        window.location.assign('http://localhost:3001/file/download/' + name + '/' + token)\n    }\n\n    //修改文件名称的接口\n    const toChangeFileFormat = async (param) => {\n        try {\n            let { msg, status } = await changeFileFormat(param)\n            if (status == '200') {\n                message.success('修改成功')\n            } else {\n                message.error(msg)\n            }\n        } catch (e) {\n            console.log(e)\n            message.error(\"访问修改接口失败\")\n        }\n    }\n\n\n    //获取未完成作业的列表\n    const getNoHomeWorkList = async () => {\n        try {\n            let { data, status, msg } = await noHomeWorkListName()\n            if (status == '200') {\n                message.success('获取未完成作业列表成功')\n                setNoHomeWorkList(data.data)\n            } else {\n                message.error(msg)\n            }\n        } catch (e) {\n            console.log(e)\n            message.error('获取未完成作业接口失败')\n        }\n    }\n\n    //获取文件详情数据的接口\n    const getDetailList = async () => {\n        try {\n            let { data, status, msg } = await detailList()\n            if (status == '200') {\n                message.success('获取列表成功')\n                setDataSource(data.data)\n            } else {\n                message.error(msg)\n            }\n        } catch (e) {\n\n        }\n    }\n\n\n    const columns = [\n        {\n            title: '姓名',\n            dataIndex: 'name',\n            key: 'name',\n        },\n        {\n            title: '学号',\n            dataIndex: 'sid',\n            key: 'sid',\n            sorter: (a, b) => Number(a.sid) - Number(b.sid)\n        }, {\n            title: '文件名称',\n            dataIndex: 'fileName',\n            key: 'fileName'\n        },\n        {\n            title: '提交时间',\n            dataIndex: 'ctime',\n            key: 'ctime',\n            sorter: (a, b) => new Date(a.ctime).getTime() - new Date(b.ctime).getTime(),\n            render: (text) => {\n                return moment(text).format('YYYY-MM-DD HH:mm:ss')\n            }\n        },\n        {\n            title: '操作',\n            dataIndex: 'action',\n            key: 'action',\n            render: (text, record) => {\n                return <Space size=\"middle\">\n                    <a onClick={() => toDeleteData(record)}>删除</a>\n                    <a onClick={() => {\n                        getOneFile(record.fileName)\n                    }}>导出</a>\n                </Space>\n            }\n        }\n    ];\n\n    const layout = {\n        labelCol: {\n            span: 6,\n        },\n        wrapperCol: {\n            span: 16,\n        },\n    }\n    const tailLayout = {\n        wrapperCol: {\n            offset: 10,\n            span: 14,\n        },\n    }\n\n    const toDeleteData = (record) => {\n        confirm({\n            title: '确定删除这条数据?',\n            okText: \"确认\",\n            cancelText: \"取消\",\n            onOk: async () => {\n                try {\n                    const { status, msg } = await deteleOne({ name: record.fileName })\n                    if (status == '200') {\n                        message.success('删除文档成功')\n                        getDetailList()\n                        getNoHomeWorkList()\n                    } else {\n                        message.error(msg)\n                    }\n                } catch (e) {\n                    console.log(e)\n                    message.error('删除单个接口失败')\n                }\n\n            },\n            onCancel() {\n                console.log('Cancel');\n            },\n        });\n    }\n\n    const toDeleteAll = () => {\n        confirm({\n            title: '确定清空数据?',\n            okText: \"确认\",\n            cancelText: \"取消\",\n            onOk: async () => {\n                try {\n                    const { status, msg } = await deleteAll()\n                    if (status == '200') {\n                        message.success('删除全部文档成功')\n                        getDetailList()\n                        getNoHomeWorkList()\n                    } else {\n                        message.error(msg)\n                    }\n                } catch (e) {\n                    message.error('删除全部接口失败')\n                }\n            },\n            onCancel() {\n                console.log('Cancel');\n            },\n        });\n    }\n\n    return (\n        <React.Fragment>\n            <h3>管理作业</h3>\n            <Card title='作业未上交名单' style={{ marginBottom: '50px' }} >\n                <div style={{ display: 'flex', flexWrap: 'wrap' }}>\n                    {\n                        Array.isArray(noHomeWorkList) ? noHomeWorkList.map((item, index) => {\n                            return <div key={index} style={{ width: '50px', textAlign: 'center', color: 'red' }}>{item}</div>\n                        }) : null\n                    }\n                </div>\n            </Card>\n            <Card title='作业内容' style={{ marginBottom: '50px' }}>\n                <div style={{ width: '600px', margin: 'auto' }}>\n                    <Form\n                        {...layout}\n                        name=\"basic\"\n                        onFinish={onFinish}\n                        form={form}\n                    >\n                        <Form.Item\n                            label=\"上传作业内容\"\n                            name=\"content\"\n                            rules={[{ required: true, message: '请输入作业内容' }]}\n                        >\n                            <Input />\n                        </Form.Item>\n\n                        <Form.Item\n                            label=\"命名格式\"\n                            name=\"format\"\n                            rules={[{ required: true, message: '请输入命名格式' }]}\n                        >\n                            <Input />\n                        </Form.Item>\n                        <Form.Item {...tailLayout}>\n                            <Button type=\"primary\" htmlType=\"submit\">\n                                提交\n                        </Button>\n                        </Form.Item>\n                    </Form>\n                </div>\n            </Card>\n            <Card title='作业列表' extra={\n                <div>\n                    <Button type='primary' style={{ fontSize: \"14px\" }} onClick={getAllFile}>全部导出</Button>\n                    <Button type='primary' style={{ fontSize: \"14px\", marginLeft: '10px' }} onClick={toDeleteAll}>清空数据</Button>\n                </div>}>\n                <Table dataSource={dataSource} columns={columns} />\n            </Card>\n        </React.Fragment>\n    )\n}\n\nexport default Manager"]},"metadata":{},"sourceType":"module"}